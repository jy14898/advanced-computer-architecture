<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>SVG</title>
    <!-- BOOTSTRAP -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">
    <!-- END BOOTSTRAP -->
    <style media="screen">
      html, body { margin:0; padding:0; overflow:hidden }
      #top { position:fixed; top:0; left:0; height:100%; width:100% }
      object { position:absolute; top:0; left:0; height: 100%; width:100% }
      #gui {
        background-color: #cbcbcb;
        color: #474747;
      }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/svg-pan-zoom@3.5.3/dist/svg-pan-zoom.min.js" ></script>
  </head>
  <body>
    <div id="top" class="container-fluid">
      <div class="row" style="height: 100%;">
        <div id="gui" class="pt-3 col-12 col-md-2">
          <form action="/processor" class="api" method="post">
            <input type="number" class="form-control" name="steps" value="10">
            <button type="submit" class="btn-block btn-primary">Step</button>
          </form>
        </div>
        <div class="col-12 col-md-10">
            <object id="processorobj" data="svg.svg" type="image/svg+xml"></object>
        </div>
        </object>
      </div>
    </div>
    <script>
    //<![CDATA[
    document.querySelector('#processorobj').addEventListener('load', function(){
      var svgdocument = document.querySelector('#processorobj').contentDocument

      // remove inline styles inkscape added on paths:
      svgdocument.querySelectorAll('.connection').forEach(function(el){
        el.removeAttribute('style')
      })

      svgdocument.querySelectorAll('.component').forEach(function(el){
        el.removeAttribute('style')
      })

      svgPanZoom(svgdocument.querySelector('#processor'), {
        zoomEnabled: true,
        fit: true,
        center: true,
      });

      (function(){
        document.querySelectorAll('form.api').forEach(function(form){
          form.addEventListener("submit", function (event) {
            event.preventDefault();

            var XHR = new XMLHttpRequest();
            var FD = new FormData(form);

            XHR.addEventListener("load", function(event) {
              alert(event.target.responseText);
            });

            XHR.open(form.getAttribute('method'), form.getAttribute('action'));

            XHR.send(FD);
          });
        })
      })()
    })
    //]]>
    </script>
  </body>
</html>
